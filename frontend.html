<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>Hua Library</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>

    <style type="text/css">
        /* Style the intro */
        #intro {
            text-align: center;
        }

        #intro h1 {
            color: rgba(0, 0, 0, 0.42);
        }

        /* Style the tab */
        div.tab {
            overflow: hidden;
            border: 1px solid #27A0A0;
            background-color: #2CBBBB;
        }

        /* Style the buttons inside the tab */
        div.tab button {
            background-color: inherit;
            color: white;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

        /* Change background color of buttons on hover */
        div.tab button:hover:enabled {
            background-color: #45D6D6;
        }

        /* Create an active/current tab-link class */
        div.tab button.active {
            background-color: #27A0A0;
        }

        /* Style the tab content */
        .tab-content {
            display: none;
            padding: 6px 12px;
            border: 1px solid #27A0A0;
            border-top: none;
            -webkit-animation: fadeEffect 1s;
            animation: fadeEffect 1s;
        }

        @-webkit-keyframes fadeEffect {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeEffect {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .form-books {
            font-family: 'Open Sans Condensed', arial, sans, serif;
            width: 500px;
            padding: 30px;
            background: #FFFFFF;
            margin: 50px auto;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.22);
            -moz-box-shadow: 0 0 15px rgba(0, 0, 0, 0.22);
            -webkit-box-shadow: 0 0 15px rgba(0, 0, 0, 0.22);

        }

        .form-books h2 {
            background: #4D4D4D;
            text-transform: uppercase;
            font-family: 'Open Sans Condensed', sans-serif;
            color: #797979;
            font-size: 18px;
            font-weight: 100;
            padding: 20px;
            margin: -30px -30px 30px -30px;
        }

        .form-books input[type="text"],
        .form-books input[type="number"],
        .form-books input[type="search"],
        .form-books select {
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            outline: none;
            display: block;
            width: 100%;
            padding: 7px;
            border: none;
            border-bottom: 1px solid #ddd;
            background: transparent;
            margin-bottom: 10px;
            font: 16px Arial, Helvetica, sans-serif;
            height: 45px;
        }

        .form-books input[type="button"],
        .form-books input[type="submit"] {
            -moz-box-shadow: inset 0 1px 0 0 #45D6D6;
            -webkit-box-shadow: inset 0 1px 0 0 #45D6D6;
            box-shadow: inset 0 1px 0 0 #45D6D6;
            background-color: #2CBBBB;
            border: 1px solid #27A0A0;
            display: inline-block;
            cursor: pointer;
            color: #FFFFFF;
            font-family: 'Open Sans Condensed', sans-serif;
            font-size: 14px;
            padding: 8px 18px;
            text-decoration: none;
            text-transform: uppercase;
        }

        .form-books input[type="button"]:hover:enabled,
        .form-books input[type="submit"]:hover:enabled {
            background: #34CACA linear-gradient(to bottom, #34CACA 5%, #30C9C9 100%);
        }

        .form-books input[type="button"]:disabled {
            -moz-box-shadow: inset 0 1px 0 0 #54ffff;
            -webkit-box-shadow: inset 0 1px 0 0 #53ffff;
            box-shadow: inset 0 1px 0 0 #51ffff;
            background-color: #3cffff;
            border: 1px solid #3effff;
        }

        /* Table Styles */

        table {
            background: white;
            border-radius: 3px;
            border-collapse: collapse;
            height: 320px;
            margin: auto;
            max-width: 600px;
            padding: 5px;
            width: 100%;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        th {
            color: #D5DDE5;;
            background: #1b1e24;
            border-bottom: 4px solid #9ea7af;
            border-right: 1px solid #343a45;
            font-size: 23px;
            font-weight: 100;
            padding: 24px;
            text-align: left;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
            vertical-align: middle;
        }

        th:first-child {
            border-top-left-radius: 3px;
        }

        th:last-child {
            border-top-right-radius: 3px;
            border-right: none;
        }

        tr {
            border-top: 1px solid #C1C3D1;
            border-bottom: 1px solid #C1C3D1;
            color: #666B85;
            font-size: 16px;
            font-weight: normal;
            text-shadow: 0 1px 1px rgba(256, 256, 256, 0.1);
        }

        tr:first-child {
            border-top: none;
        }

        tr:last-child {
            border-bottom: none;
        }

        tr:nth-child(odd) td {
            background: #EBEBEB;
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 3px;
        }

        tr:last-child td:last-child {
            border-bottom-right-radius: 3px;
        }

        td {
            background: #FFFFFF;
            padding: 20px;
            text-align: left;
            vertical-align: middle;
            font-weight: 300;
            font-size: 18px;
            text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.1);
            border-right: 1px solid #C1C3D1;
        }

        td:last-child {
            border-right: 0;
        }

        th, td {
            text-align: left;
        }
    </style>

    <script type="text/javascript">
        var searchBook = function () {
            var key = document.getElementById('keyword').value;

            if (!key)
                alert('Please enter a keyword before continuing.');

            else {
                var xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {
                        var response = JSON.parse(this.responseText);

                        if (response.length > 0) {
                            var result = "<table><thead><tr>" +
                                "<th>Id</th>" +
                                "<th>Author</th>" +
                                "<th>Title</th>" +
                                "<th>Genre</th>" +
                                "<th>Price</th>" +
                                "</tr></thead><tbody class='table-hover'>";

                            for (var book in response) {
                                result += "<tr><td>" + response[book].id + "</td>" +
                                    "<td>" + response[book].author + "</td>" +
                                    "<td>" + response[book].title + "</td>" +
                                    "<td>" + response[book].genre + "</td>" +
                                    "<td>" + response[book].price + "</td></tr>";
                            }

                            result += "</tbody></table>";
                            document.getElementById('searchResult').innerHTML = result;
                        }

                        else {
                            document.getElementById('searchResult').innerHTML = "";
                            alert("No books were found");
                        }
                    }
                };

                xhr.open("GET", "http://hua-library.azurewebsites.net/books?pattern=" + key);
                xhr.send();
            }
        };


        var addBook = function () {
            var author = document.getElementById('author').value;
            var title = document.getElementById('title').value;
            var genre = document.getElementById('genre').value;
            var price = document.getElementById('price').value;

            if (!author || !title || !genre || !price)
                alert('Please fill in all the fields before continuing.');

            else {
                validatePrice();

                if (priceIsValid) {
                    var data = JSON.stringify({
                        "author": author,
                        "title": title,
                        "genre": genre,
                        "price": price
                    });

                    var xhr = new XMLHttpRequest();

                    xhr.onreadystatechange = function () {
                        if (this.readyState === 4 && this.status === 200) {
                            document.getElementById('addBookButton').disabled = true;
                            document.getElementById('addResponse').innerHTML = JSON.parse(this.responseText).message;

                            setTimeout(function () {
                                document.getElementById('addResponse').innerHTML = "";
                                document.getElementById('addBookButton').disabled = false;
                            }, 3000)
                        }
                    };

                    xhr.open("POST", "http://hua-library.azurewebsites.net/books");
                    xhr.setRequestHeader("content-type", "application/json");
                    xhr.send(data);
                }

                else
                    alert('Invalid price.');
            }
        };

        var priceIsValid = false;

        var validatePrice = function () {
            priceIsValid = false;

            var price = document.getElementById('price').value;
            var reContainsChars = new RegExp('[^,.\-_]');
            var reValidPrice = new RegExp('^([1-9][0-9]*|0)(\.[0-9]{2})?$');

            if (!price)
                document.getElementById('hint').innerHTML = '*Price cannot be empty.';

            else if (reContainsChars.test(price))
                document.getElementById('hint').innerHTML = '*Price cannot contain characters.';

            else if (price.indexOf(',') > -1)
                document.getElementById('hint').innerHTML = '*You should use dot instead of comma.';

            else if (price.charAt(0) === '.')
                document.getElementById('hint').innerHTML = '*Price cannot start with a dot.';

            else if (price.split(".").length > 2)
                document.getElementById('hint').innerHTML = '*You should use only one dot.';

            else if (!reValidPrice.test(price))
                document.getElementById('hint').innerHTML =
                    '*A valid price has to contain exactly 2 decimal digits.';

            else {
                document.getElementById('hint').innerHTML = '';
                priceIsValid = true;
            }
        };

        // Open a tab.
        function openTab(event, tabName) {
            // Declare all variables
            var tabContent, tabLinks, i;

            // Get all elements with class="tab-content" and hide them
            tabContent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabContent.length; ++i)
                tabContent[i].style.display = "none";

            // Get all elements with class="tab-links" and remove the class "active"
            tabLinks = document.getElementsByClassName("tab-links");
            for (i = 0; i < tabLinks.length; ++i)
                tabLinks[i].className = tabLinks[i].className.replace(" active", "");

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tabName).style.display = "block";
            event.currentTarget.className += " active";
        }
    </script>
</head>

<body>

<div id="intro">
    <img src="images/hua_logo.jpg" height="100" width="100"/>
    <h1>Welcome to HUA Library</h1>
</div>

<div class="tab">
    <button class="tab-links active" onclick="openTab(event, 'search')">Search Book</button>
    <button class="tab-links" onclick="openTab(event, 'add')">Add Book</button>
</div>

<div id="search" class="tab-content" style="display: block">
    <div class="form-books">
        <h2>Search a book</h2>
        <form action="#" onsubmit="searchBook()">
            <input id="keyword" type="search" placeholder="Enter keywords..."/>
            <input type="button" value="Search" onclick="searchBook()"/>
        </form>
    </div>

    <div id="searchResult"></div>
</div>

<div id="add" class="tab-content">
    <div class="form-books">
        <h2>Add a new book</h2>
        <form action="#">
            <input id="author" type="text" placeholder="Author"/>
            <input id="title" type="text" placeholder="Title"/>
            <select id="genre" title="Genre">
                <option selected disabled value="">Choose genre</option>
                <option value="Science fiction">Science fiction</option>
                <option value="Satire">Satire</option>
                <option value="Drama">Drama</option>
                <option value="Action and Adventure">Action and Adventure</option>
                <option value="Romance">Romance</option>
                <option value="Mystery">Mystery</option>
                <option value="Horror">Horror</option>
            </select>
            <input id="price" type="text" placeholder="Price" onkeyup="validatePrice()"/>
            <div id="hint" style="color: red; margin: 0 0 15px 15px; font-weight: bold"></div>
            <input id="addBookButton" type="button" value="Add Book" onclick="addBook()"/>
        </form>

        <h3 id="addResponse" style="color: #27A0A0"></h3>
    </div>
</div>

</body>
</html>
